<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Twin - Mining Risk Visualization</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/timeline.css">
    <link rel="stylesheet" href="css/alerts.css">
    <link rel="stylesheet" href="css/detail.css">
    <link rel="stylesheet" href="css/ai.css">
    <link rel="stylesheet" href="css/camera-controls.css">
    <link rel="stylesheet" href="css/demo.css">
    <link rel="stylesheet" href="css/help.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,1,0" rel="stylesheet">
</head>
<body>
    <div id="app">
        <div id="canvas-container"></div>

        <!-- Client Logo (top-left) -->
        <div id="client-logo">
            <img src="assets/client-logo.png" alt="Client Logo">
        </div>

        <!-- Branding (bottom-right) -->
        <div id="branding">
            <div id="branding-text">
                Digital Twin - Mining Risk Visualization Demo<br>
                <span>prepared by RevDev Asia</span>
            </div>
            <img src="assets/revdev-logo.png" alt="RevDev" id="revdev-logo">
        </div>

        <!-- Left sidebar: Filters + Alerts + AI Insights -->
        <div id="left-sidebar" class="sidebar">
            <div id="filter-panel"></div>
            <div id="alerts-container"></div>
            <div id="ai-insights-container"></div>
        </div>

        <!-- Top bar with mode indicator and controls -->
        <div id="top-bar">
            <div id="mode-indicator" class="mode-indicator live">LIVE</div>
            <button id="demo-mode-toggle" class="demo-mode-toggle" title="Toggle Demo Mode (Ctrl+Shift+D)">
                <span class="demo-toggle-icon">ðŸŽ¬</span>
                <span class="demo-toggle-label">Demo</span>
            </button>
            <div id="ai-status" class="ai-status-indicator">
                <span class="ai-badge">AI</span>
                <span class="ai-status-text">Checking...</span>
            </div>
            <button id="reset-camera" class="control-btn">Reset View</button>
            <div class="bg-color-picker-wrapper" title="Change background color">
                <input type="color" id="bg-color-picker" class="bg-color-picker" value="#1a1a2e">
                <span class="bg-color-label">BG</span>
            </div>
            <button id="theme-toggle" class="control-btn theme-btn" title="Toggle light/dark mode">
                <svg class="theme-icon sun-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="5"></circle>
                    <line x1="12" y1="1" x2="12" y2="3"></line>
                    <line x1="12" y1="21" x2="12" y2="23"></line>
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                    <line x1="1" y1="12" x2="3" y2="12"></line>
                    <line x1="21" y1="12" x2="23" y2="12"></line>
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                </svg>
                <svg class="theme-icon moon-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
            </button>
            <button id="help-button" class="control-btn help-btn" title="Help (?)">
                <span class="material-symbols-rounded">help</span>
            </button>
        </div>

        <!-- Right sidebar: Detail Panel -->
        <div id="detail-container"></div>

        <!-- Camera Controls Panel -->
        <div id="camera-controls-container"></div>

        <!-- Timeline at bottom -->
        <div id="timeline-container"></div>

        <!-- AI Query Interface -->
        <div id="query-container" class="query-panel"></div>

        <!-- Tooltip -->
        <div id="tooltip" class="tooltip"></div>
    </div>

    <script src="js/env.js"></script>
    <script>
        // Theme toggle functionality
        (function() {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);

            document.addEventListener('DOMContentLoaded', function() {
                const toggle = document.getElementById('theme-toggle');
                const sunIcon = toggle.querySelector('.sun-icon');
                const moonIcon = toggle.querySelector('.moon-icon');

                function updateIcons() {
                    const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
                    // In dark mode, show sun (to switch to light)
                    // In light mode, show moon (to switch to dark)
                    sunIcon.style.display = isDark ? 'block' : 'none';
                    moonIcon.style.display = isDark ? 'none' : 'block';
                }

                updateIcons();

                toggle.addEventListener('click', function() {
                    const current = document.documentElement.getAttribute('data-theme');
                    const next = current === 'dark' ? 'light' : 'dark';
                    document.documentElement.setAttribute('data-theme', next);
                    localStorage.setItem('theme', next);
                    updateIcons();

                    // Dispatch event for Three.js scene to update
                    window.dispatchEvent(new CustomEvent('themechange', { detail: { theme: next } }));
                });

                // Background color picker
                const bgColorPicker = document.getElementById('bg-color-picker');

                // Load saved background color or use default based on theme
                const savedBgColor = localStorage.getItem('bgColor');
                if (savedBgColor) {
                    bgColorPicker.value = savedBgColor;
                } else {
                    // Set default based on current theme (must match CONFIG.COLORS values)
                    const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
                    bgColorPicker.value = isDark ? '#1a1a2e' : '#e8eaed';
                }

                bgColorPicker.addEventListener('input', function(e) {
                    const color = e.target.value;
                    localStorage.setItem('bgColor', color);
                    window.dispatchEvent(new CustomEvent('bgcolorchange', { detail: { color: color } }));
                });
            });
        })();
    </script>
    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/",
            "gsap": "https://cdn.jsdelivr.net/npm/gsap@3.12.5/index.js"
        }
    }
    </script>
    <script type="module" src="js/main.js?v=20260128b"></script>
</body>
</html>
